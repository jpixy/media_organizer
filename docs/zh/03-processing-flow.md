# 03 - æ ¸å¿ƒå¤„ç†æµç¨‹

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£æè¿° Media Organizer çš„æ ¸å¿ƒå¤„ç†æµç¨‹ï¼ŒåŒ…æ‹¬å…ƒæ•°æ®æå–ã€TMDB åŒ¹é…å’Œæ–‡ä»¶å¤„ç†é€»è¾‘ã€‚

---

## 2. æ–‡ä»¶å¤„ç†æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         æ–‡ä»¶å¤„ç†å…¥å£                                  â”‚
â”‚                      process_video(file)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 1: æ–‡ä»¶ç±»å‹åˆ¤æ–­                               â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ æ˜¯å·²æ•´ç†æ ¼å¼?    â”‚â”€â”€Yesâ”€â”€â–¶ æå– TMDB ID â”€â”€â–¶ é˜¶æ®µ 4 (ç›´æ¥æŸ¥è¯¢)      â”‚
â”‚  â”‚ [Title]-S01E01  â”‚                                                â”‚
â”‚  â”‚ [Title](Year)-  â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚ No                                                      â”‚
â”‚           â–¼                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                â”‚
â”‚  â”‚ åœ¨å·²æ•´ç†ç›®å½•ä¸­?  â”‚â”€â”€Yesâ”€â”€â–¶ ä»ç›®å½•æå– TMDB ID â”€â”€â–¶ é˜¶æ®µ 4          â”‚
â”‚  â”‚ (ç¥–å…ˆç›®å½•æœ‰     â”‚                                                â”‚
â”‚  â”‚  tmdb æ ‡è¯†)     â”‚                                                â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                â”‚
â”‚           â”‚ No                                                      â”‚
â”‚           â–¼                                                         â”‚
â”‚       å…¨æ–°æ–‡ä»¶ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ é˜¶æ®µ 2 (å®Œæ•´è§£ææµç¨‹)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 2: ä¿¡æ¯æ”¶é›† (ä»…å…¨æ–°æ–‡ä»¶)                       â”‚
â”‚                                                                     â”‚
â”‚  2.1 ä»æ–‡ä»¶åæå–                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  extract_from_filename(filename) -> FilenameInfo            â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ æ ‡é¢˜ (ä¸­æ–‡/è‹±æ–‡)                                      â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ å¹´ä»½                                                  â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ å­£/é›†å· (TV Shows)                                    â”‚   â”‚
â”‚  â”‚    â””â”€â”€ æŠ€æœ¯ä¿¡æ¯ (åˆ†è¾¨ç‡ã€ç¼–ç ç­‰)                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  2.2 ç›®å½•ç±»å‹åˆ¤æ–­ä¸ä¿¡æ¯æå–                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  classify_directory(dir_name) -> DirectoryType              â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ TitleDirectory  (ä½œå“ç›®å½•: åŒ…å«ä½œå“å)                â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ SeasonDirectory (å­£ç›®å½•: Season 01, ç¬¬ä¸€å­£)           â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ QualityDirectory (è´¨é‡ç›®å½•: 4K, 1080P)               â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ CategoryDirectory (åˆ†ç±»ç›®å½•: æ¼”å‘˜å/ç³»åˆ—å/å¹´ä»½)      â”‚   â”‚
â”‚  â”‚    â””â”€â”€ Unknown (æ— æ³•åˆ¤æ–­)                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  å‘ä¸Šéå†ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ª TitleDirectory                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  2.3 åˆå¹¶ä¿¡æ¯                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  merge_info(filename_info, dir_info) -> CandidateMetadata   â”‚   â”‚
â”‚  â”‚    ä¼˜å…ˆçº§: æ–‡ä»¶åä¿¡æ¯ > ç›®å½•ä¿¡æ¯ (æ–‡ä»¶åæ›´å…·ä½“)               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 3: AI è¡¥å…… (æŒ‰éœ€)                            â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  if candidate.needs_ai_parsing():                           â”‚   â”‚
â”‚  â”‚      # å½“ä»¥ä¸‹æƒ…å†µæ—¶éœ€è¦ AI:                                  â”‚   â”‚
â”‚  â”‚      # - æ²¡æœ‰ä¸­æ–‡æ ‡é¢˜ä¹Ÿæ²¡æœ‰è‹±æ–‡æ ‡é¢˜                          â”‚   â”‚
â”‚  â”‚      # - æ ‡é¢˜çœ‹èµ·æ¥åƒæ˜¯ç¼–ç /æŠ€æœ¯ä¿¡æ¯                         â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚      ai_result = parser.parse(filename + context)           â”‚   â”‚
â”‚  â”‚      candidate.merge_ai_result(ai_result)                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 4: TMDB åŒ¹é…                                 â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4A: å¦‚æœæœ‰ TMDB ID (æ¥è‡ªå·²æ•´ç†æ ¼å¼)                         â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ ç›´æ¥è°ƒç”¨ get_movie_details(tmdb_id) æˆ–             â”‚   â”‚
â”‚  â”‚      â”‚            get_tv_details(tmdb_id)                   â”‚   â”‚
â”‚  â”‚      â””â”€â”€ å¿«é€Ÿè·å–æœ€æ–°ä¿¡æ¯ï¼Œæ— éœ€æœç´¢                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  4B: å¦‚æœæ²¡æœ‰ TMDB ID (å…¨æ–°æ–‡ä»¶)                             â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ ä½¿ç”¨å€™é€‰å…ƒæ•°æ®æœç´¢                                  â”‚   â”‚
â”‚  â”‚      â”œâ”€â”€ æœç´¢ä¼˜å…ˆçº§:                                         â”‚   â”‚
â”‚  â”‚      â”‚   1. ä¸­è‹±æ–‡æ ‡é¢˜ + å¹´ä»½ (æœ€ç²¾ç¡®)                       â”‚   â”‚
â”‚  â”‚      â”‚   2. è‹±æ–‡æ ‡é¢˜ + å¹´ä»½                                  â”‚   â”‚
â”‚  â”‚      â”‚   3. ä¸­æ–‡æ ‡é¢˜ + å¹´ä»½                                  â”‚   â”‚
â”‚  â”‚      â”‚   4. ä»…æ ‡é¢˜ (æ— å¹´ä»½)                                  â”‚   â”‚
â”‚  â”‚      â””â”€â”€ éªŒè¯åŒ¹é…è´¨é‡ï¼Œä¸ç¡®å®šåˆ™è·³è¿‡                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â”‚
                                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    é˜¶æ®µ 5: éªŒè¯ä¸å†³ç­–                                â”‚
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  validate_match(tmdb_result, candidate) -> MatchQuality     â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  MatchQuality:                                               â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ Exact     (ç²¾ç¡®åŒ¹é…: æ ‡é¢˜+å¹´ä»½å®Œå…¨ä¸€è‡´)               â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ High      (é«˜ç½®ä¿¡: æ ‡é¢˜ç›¸ä¼¼ä¸”å¹´ä»½åŒ¹é…)                â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ Medium    (ä¸­ç½®ä¿¡: æ ‡é¢˜ç›¸ä¼¼æˆ–å¹´ä»½æ¥è¿‘)                â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ Low       (ä½ç½®ä¿¡: ä»…éƒ¨åˆ†åŒ¹é…)                        â”‚   â”‚
â”‚  â”‚    â””â”€â”€ NoMatch   (æ— åŒ¹é…)                                    â”‚   â”‚
â”‚  â”‚                                                              â”‚   â”‚
â”‚  â”‚  å†³ç­–è§„åˆ™:                                                    â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ Exact/High  -> å¤„ç†                                   â”‚   â”‚
â”‚  â”‚    â”œâ”€â”€ Medium      -> æ ¹æ®é…ç½®å†³å®š (é»˜è®¤è·³è¿‡)                â”‚   â”‚
â”‚  â”‚    â””â”€â”€ Low/NoMatch -> è·³è¿‡ (å®å¯é—æ¼ï¼Œä¸èƒ½é”™è¯¯)              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ç›®å½•ç±»å‹åˆ†ç±»

### 3.1 ç›®å½•ç±»å‹å®šä¹‰

| ç±»å‹ | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| **TitleDirectory** | ä½œå“ç›®å½•ï¼ŒåŒ…å«ä½œå“å | `å‰å°”è«Â·å¾·å°”Â·æ‰˜ç½— Guillermo (2022)` |
| **SeasonDirectory** | å­£ç›®å½• | `Season 01`, `ç¬¬ä¸€å­£`, `S01` |
| **QualityDirectory** | è´¨é‡/æŠ€æœ¯æè¿° | `4K`, `1080P`, `BluRay`, `å†…å°å­—å¹•` |
| **CategoryDirectory** | åˆ†ç±»ç›®å½• | `å‘¨æ˜Ÿé©°`, `æ¼«å¨ç”µå½±`, `2024`, `éŸ©å‰§` |
| **OrganizedDirectory** | å·²æ•´ç†ç›®å½• | `[ç½šç½ª2](2025)-tt36771056-tmdb296146` |

### 3.2 åˆ†ç±»ç›®å½•è¯†åˆ«è§„åˆ™

```rust
fn is_category_directory(name: &str) -> bool {
    // åœ°åŒºåˆ†ç±»
    // éŸ©å‰§, ç¾å‰§, æ—¥å‰§, è‹±å‰§, å›½äº§å‰§, æ¸¯å‰§, å°å‰§
    // éŸ©å›½, ç¾å›½, æ—¥æœ¬, ä¸­å›½, é¦™æ¸¯
    
    // å¹´ä»½åˆ†ç±»
    // 2024, 2024å¹´, 2024å¹´æ–°ç•ª
    
    // ç±»å‹åˆ†ç±»
    // ç”µå½±, ç”µè§†å‰§, ç»¼è‰º, åŠ¨æ¼«, çºªå½•ç‰‡
    
    // ç³»åˆ—å
    // æ¼«å¨, DC, æ˜Ÿçƒå¤§æˆ˜, å“ˆåˆ©æ³¢ç‰¹
}
```

### 3.3 ä½œå“ç›®å½•è¯†åˆ«è§„åˆ™

ä½œå“ç›®å½•çš„å…¸å‹æ ¼å¼ï¼š
- `ä¸­æ–‡æ ‡é¢˜ è‹±æ–‡æ ‡é¢˜ (å¹´ä»½)`
- `ä¸­æ–‡æ ‡é¢˜ (å¹´ä»½)`
- `è‹±æ–‡æ ‡é¢˜ (å¹´ä»½)`
- `ä¸­æ–‡æ ‡é¢˜.è‹±æ–‡æ ‡é¢˜.å¹´ä»½`

---

## 4. å·²æ•´ç†æ ¼å¼è¯†åˆ«

### 4.1 å·²æ•´ç†æ–‡ä»¶åæ ¼å¼

**ç”µå½±**ï¼š
```
[Title](Year)-ttIMDB-tmdbTMDB-resolution-format-codec-bitdepth-audio-channels.ext
```

æ­£åˆ™ï¼š
```regex
^\[.+\]\(\d{4}\)-tt\d+-tmdb\d+-.+\.(mp4|mkv|avi)$
```

**ç”µè§†å‰§**ï¼š
```
[ShowTitle]-SXXEXX-[EpisodeTitle]-resolution-format-codec-bitdepth-audio-channels.ext
```

æ­£åˆ™ï¼š
```regex
^\[.+\]-S\d{1,2}E\d{1,3}-\[.+\]-.+\.(mp4|mkv|avi)$
```

### 4.2 å·²æ•´ç†ç›®å½•åæ ¼å¼

```
[Title](Year)-ttIMDB-tmdbTMDB
```

æ­£åˆ™ï¼š
```regex
^\[.+\]\(\d{4}\)-tt\d+-tmdb(\d+)$
```

### 4.3 æå–ä¿¡æ¯

ä»å·²æ•´ç†æ ¼å¼ä¸­æå–ï¼š
- TMDB ID
- IMDB ID
- æ ‡é¢˜
- å¹´ä»½
- å­£å·/é›†å· (ç”µè§†å‰§)

---

## 5. TV Show ç‰¹æ®Šå¤„ç†

### 5.1 å­£ç¼“å­˜æœºåˆ¶

å¯¹äºåŒä¸€ç›®å½•ä¸‹çš„å¤šä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨ç¼“å­˜å‡å°‘ API è°ƒç”¨ï¼š

```
ç›®å½•: [ç½šç½ª2](2025)-tmdb296146/Season 01/
  â”‚
  â”œâ”€â”€ E01.mp4 â”€â”€â–¶ æŸ¥è¯¢ TMDB + è·å–å…¨å­£é›†æ•° â”€â”€â–¶ ç¼“å­˜
  â”œâ”€â”€ E02.mp4 â”€â”€â–¶ ä½¿ç”¨ç¼“å­˜
  â”œâ”€â”€ E03.mp4 â”€â”€â–¶ ä½¿ç”¨ç¼“å­˜
  â””â”€â”€ E04.mp4 â”€â”€â–¶ ä½¿ç”¨ç¼“å­˜
```

### 5.2 é›†å·æå–

ä¼˜å…ˆä½¿ç”¨æ­£åˆ™æå–é›†å·ï¼ŒAI è§£æä½œä¸ºè¡¥å……ï¼š

```rust
// æ­£åˆ™æ¨¡å¼
S01E01, S1E1
E01, E1, EP01
ç¬¬01é›†, ç¬¬1é›†
01.mp4, 1.mp4 (çº¯æ•°å­—)
```

### 5.3 ä»ç›®å½•æå–å­£å·

```rust
// æ­£åˆ™æ¨¡å¼
Season 01, Season 1
S01, S1
ç¬¬ä¸€å­£, ç¬¬1å­£
```

---

## 6. TMDB åŒ¹é…ç­–ç•¥

### 6.1 æœç´¢ä¼˜å…ˆçº§

1. **ä¸­è‹±æ–‡äº¤é›†åŒ¹é…** (æœ€å¯é )
   - åŒæ—¶æœç´¢ä¸­æ–‡å’Œè‹±æ–‡æ ‡é¢˜
   - å–ä¸¤ä¸ªç»“æœçš„äº¤é›†
   - å¦‚æœæœ‰äº¤é›†ï¼Œä»ä¸­é€‰æ‹©æœ€ä½³åŒ¹é…

2. **è‹±æ–‡æ ‡é¢˜åŒ¹é…**
   - ä»…ä½¿ç”¨è‹±æ–‡æ ‡é¢˜æœç´¢
   - é€‰æ‹©æœ€ä½³åŒ¹é…

3. **ä¸­æ–‡æ ‡é¢˜åŒ¹é…**
   - ä»…ä½¿ç”¨ä¸­æ–‡æ ‡é¢˜æœç´¢
   - é€‰æ‹©æœ€ä½³åŒ¹é…

### 6.2 æœ€ä½³åŒ¹é…é€‰æ‹©

```rust
fn select_best_match(query: &str, results: &[SearchResult]) -> Option<SearchResult> {
    // æ’é™¤æœªæ¥å‘è¡Œçš„ä½œå“
    // è®¡ç®—æ ‡é¢˜ç›¸ä¼¼åº¦å¾—åˆ†
    // è€ƒè™‘æŠ•ç¥¨æ•°ä½œä¸ºå¯ä¿¡åº¦æŒ‡æ ‡
    // ç²¾ç¡®åŒ¹é… > åŒ…å«åŒ¹é… > ç›¸ä¼¼åŒ¹é…
}
```

### 6.3 åŒ¹é…éªŒè¯

éªŒè¯æ ‡å‡†ï¼š
- æ ‡é¢˜ç›¸ä¼¼åº¦ > 0.7
- å¹´ä»½åŒ¹é… (å…è®¸ Â±1 å¹´åå·®)
- å›½å®¶ä¿¡æ¯ä¸€è‡´ (å¦‚æœå¯ç”¨)

---

## 7. å¢é‡æ•´ç†å¤„ç†

### 7.1 åœºæ™¯ï¼šæ–°å¢å‰§é›†

```
å·²æ•´ç†ç›®å½•:
[ç½šç½ª2](2025)-tt36771056-tmdb296146/
â”œâ”€â”€ Season 01/
â”‚   â”œâ”€â”€ [ç½šç½ª2]-S01E01-[ç¬¬1é›†]-1080p.mp4   âœ… å·²æ•´ç†
â”‚   â”œâ”€â”€ [ç½šç½ª2]-S01E02-[ç¬¬2é›†]-1080p.mp4   âœ… å·²æ•´ç†
â”‚   â””â”€â”€ ç½šç½ª2.E03.1080p.mp4                 ğŸ†• æ–°å¢
```

å¤„ç†æµç¨‹ï¼š
1. è¯†åˆ«æ–°æ–‡ä»¶ `ç½šç½ª2.E03.1080p.mp4`
2. æ£€æµ‹å…¶åœ¨å·²æ•´ç†ç›®å½•ä¸­
3. ä»ç›®å½•åæå– TMDB ID (296146)
4. ä½¿ç”¨æ­£åˆ™æå–é›†å· (E03)
5. ç›´æ¥æŸ¥è¯¢ TMDB è·å–ç¬¬3é›†è¯¦æƒ…
6. ç”Ÿæˆç›®æ ‡æ–‡ä»¶å

### 7.2 åœºæ™¯ï¼šé‡æ–°æ•´ç†

```
å·²æ•´ç†æ–‡ä»¶:
[Avatar](2009)-tt0499549-tmdb19995-1080p.mp4
```

å¤„ç†æµç¨‹ï¼š
1. è¯†åˆ«æ–‡ä»¶åä¸ºå·²æ•´ç†æ ¼å¼
2. æå– TMDB ID (19995)
3. ç›´æ¥æŸ¥è¯¢ TMDB è·å–æœ€æ–°è¯¦æƒ…
4. ä½¿ç”¨æ–°è¯¦æƒ…ç”Ÿæˆç›®æ ‡ (å¯èƒ½æ›´æ–° NFO)

---

## 8. æ€§èƒ½ä¼˜åŒ–

### 8.1 å¹¶è¡Œå¤„ç†

| æ“ä½œ | å¹¶è¡ŒåŒ– |
|------|--------|
| ffprobe è°ƒç”¨ | ä½¿ç”¨ `futures::join_all` å¹¶è¡Œ |
| æµ·æŠ¥ä¸‹è½½ | ä½¿ç”¨ `futures::join_all` å¹¶è¡Œ |
| TMDB API | å—é™äº API é™æµï¼Œé¡ºåºæ‰§è¡Œ |

### 8.2 ç¼“å­˜ç­–ç•¥

| ç¼“å­˜ç±»å‹ | ä½œç”¨åŸŸ | å†…å®¹ |
|----------|--------|------|
| TV Show ç¼“å­˜ | åŒä¸€ç›®å½• | å‰§é›†å…ƒæ•°æ® |
| å­£é›†æ•°ç¼“å­˜ | åŒä¸€å‰§é›†åŒä¸€å­£ | å…¨å­£æ‰€æœ‰é›†çš„è¯¦æƒ… |
| TMDB æœç´¢ç¼“å­˜ | å¯é€‰ | æœç´¢ç»“æœ (æœªå®ç°) |

---

## 9. é”™è¯¯å¤„ç†ä¸æ—¥å¿—

### 9.1 é”™è¯¯åˆ†ç±»

| é”™è¯¯ç±»å‹ | å¤„ç†æ–¹å¼ | æ—¥å¿—çº§åˆ« |
|----------|----------|----------|
| AI è§£æå¤±è´¥ | è·³è¿‡ï¼Œæ ‡è®°ä¸º unknown | WARN |
| TMDB æ— åŒ¹é… | è·³è¿‡ï¼Œæ ‡è®°ä¸º unknown | WARN |
| TMDB ä¸ç¡®å®šåŒ¹é… | è·³è¿‡ï¼Œæ ‡è®°ä¸º unknown | INFO |
| ffprobe å¤±è´¥ | ä½¿ç”¨æ–‡ä»¶åå…ƒæ•°æ® | WARN |
| ç½‘ç»œé”™è¯¯ | é‡è¯•æˆ–ä¸­æ–­ | ERROR |

### 9.2 æ—¥å¿—ç¤ºä¾‹

```
[SCAN] Found 276 video files in /path/to/source
[AI] Parsing: movie.mp4 (CPU inference may take 1-3 min)
[TMDB] Found match: Avatar (2009) - tmdb19995
[ORGANIZED] Re-indexing: [ç½šç½ª2]-S01E01-... (using tmdb296146)
[WARN] Skipped: unknown.mp4 - No TMDB match
[OK] Plan generated: 268 items, 8 unknown
```

---

## 10. å¾…å®ç°çš„é‡æ„

### 10.1 ç»Ÿä¸€å…ƒæ•°æ®æå–

åˆ›å»º `CandidateMetadata` ç»“æ„ï¼Œç»Ÿä¸€ä¿¡æ¯æ”¶é›†ï¼š

```rust
pub struct CandidateMetadata {
    pub chinese_title: Option<String>,
    pub english_title: Option<String>,
    pub year: Option<u16>,
    pub season: Option<u32>,
    pub episode: Option<u32>,
    pub tmdb_id: Option<u64>,
    pub imdb_id: Option<String>,
    pub source: MetadataSource,
    pub confidence: f32,
}
```

### 10.2 ç›®å½•ç±»å‹åˆ†ç±»

å®ç°æ™ºèƒ½ç›®å½•åˆ†ç±»ï¼š

```rust
pub enum DirectoryType {
    TitleDirectory(TitleInfo),
    SeasonDirectory(u32),
    QualityDirectory,
    CategoryDirectory,
    OrganizedDirectory(OrganizedInfo),
    Unknown,
}
```

### 10.3 å®ç°ä¼˜å…ˆçº§

| ä¼˜å…ˆçº§ | ä»»åŠ¡ | é¢„ä¼°å·¥æ—¶ |
|--------|------|----------|
| P0 | ç›®å½•ç±»å‹åˆ†ç±» | 2h |
| P0 | ç»Ÿä¸€å…ƒæ•°æ®æå– | 3h |
| P1 | ä»ç›®å½•æå–ä¸­è‹±æ–‡æ ‡é¢˜ | 2h |
| P1 | é‡æ„ TMDB æœç´¢å…¥å£ | 2h |
| P2 | é›†æˆæµ‹è¯•éªŒè¯ | 2h |

